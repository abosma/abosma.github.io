(()=>{var i=class{constructor(e,t){this.x=0;this.y=0;e!==void 0&&(this.x=e),t!==void 0&&(this.y=t)}add(e){return e instanceof i?new i(this.x+e.x,this.y+e.y):new i(this.x+e,this.y+e)}subtract(e){return e instanceof i?new i(this.x-e.x,this.y-e.y):new i(this.x-e,this.y-e)}multiply(e){return e instanceof i?new i(this.x*e.x,this.y*e.y):new i(this.x*e,this.y*e)}static addVectors(e,t){return new i(e.x+t.x,e.y+t.y)}static subtractVectors(e,t){return new i(e.x-t.x,e.y-t.y)}static multiplyVectors(e,t){return new i(e.x*t.x,e.y*t.y)}static distance(e,t){return i.len(i.subtractVectors(e,t))}static normalize(e){let t=i.len(e);return new i(e.x/t,e.y/t)}static len(e){return Math.sqrt(e.x*e.x+e.y*e.y)}};var a=class{constructor(){this.renderers=new Array;this.debugText=new Array}start(){this.displayCanvas=document.querySelector("#canvas"),this.offscreenCanvas=document.createElement("canvas"),this.offscreenCanvas.width=this.displayCanvas.width,this.offscreenCanvas.height=this.displayCanvas.height,this.displayContext=this.displayCanvas.getContext("2d"),this.offscreenContext=this.offscreenCanvas.getContext("2d")}static getInstance(){return a.instance||(a.instance=new a),a.instance}addRenderer(e){this.renderers.indexOf(e)==-1&&this.renderers.push(e)}addDebugText(e){this.debugText=e.slice(-20)}update(e){this.clearScreen(),this.drawRenderers(),this.drawDebug(),this.displayContext.drawImage(this.offscreenCanvas,0,0,this.offscreenCanvas.width,this.offscreenCanvas.height)}clearScreen(){this.offscreenContext.fillRect(0,0,this.displayCanvas.width,this.displayCanvas.height)}drawRenderers(){for(let e=this.renderers.length;e--;){let t=this.renderers[e],n=t.image,c=n.width,p=n.height,G=t.gameObject.transform.position.x,L=t.gameObject.transform.position.y;this.offscreenContext.drawImage(n,G,L,c,p)}}drawDebug(){this.offscreenContext.fillStyle="white",this.offscreenContext.globalAlpha=.5,this.offscreenContext.fillRect(this.displayCanvas.width*.8,this.displayCanvas.height*.03,300,320),this.offscreenContext.font="small-caps bold 12px sans-serif",this.offscreenContext.fillStyle="black",this.offscreenContext.globalAlpha=1;for(let e=this.debugText.length;e--;)this.offscreenContext.fillText(this.debugText[e],this.displayCanvas.width*.81,this.displayCanvas.height*.06+15*e)}};var h=class{constructor(e){e!==void 0&&(this.image=e),a.getInstance().addRenderer(this)}start(){}update(e){}};var f=class{constructor(e,t,n,c,p){this.position=new i;this.isMoving=!1;e!==void 0&&(this.position.x=e),t!==void 0&&(this.position.y=t),n!==void 0&&(this.width=n),c!==void 0&&(this.height=c),p!==void 0&&(this.position=p)}start(){}update(e){this.isMoving&&(this.position=i.addVectors(this.position,this.direction.multiply(this.speed*e)),i.distance(this.startPosition,this.position)>=this.distance&&(this.position=this.endPosition,this.isMoving=!1))}moveTo(e,t){this.startPosition=this.position,this.endPosition=e,this.distance=i.distance(this.startPosition,e),this.speed=t/1e3,this.direction=i.normalize(i.subtractVectors(e,this.startPosition)),this.isMoving=!0}getCenter(){let e=this.gameObject.getComponent(h);if(!e)return;let t=e.image.width,n=e.image.height;return new i(this.position.x+t/2,this.position.y+n/2)}};var u=class{start(){this.transform=this.gameObject.getComponent(f)}update(e){}};var d=class{constructor(){}static getInstance(){return d.instance||(d.instance=new d),d.instance}start(){document.addEventListener("keydown",e=>{e.defaultPrevented||d.pressedKeys.indexOf(e.code)==-1&&d.pressedKeys.push(e.code)}),document.addEventListener("keyup",e=>{if(e.defaultPrevented)return;let t=d.pressedKeys.indexOf(e.code);t!=-1&&d.pressedKeys.splice(t,1)})}static keyDown(e){return this.pressedKeys.indexOf(e)!=-1}},o=d;o.pressedKeys=new Array;var m=class{constructor(){this.renderHandler=a.getInstance();this.logs=[];this.logs=[],window.setInterval(this.printLogs,1e3)}static getInstance(){return m.instance||(m.instance=new m),m.instance}addLog(e){this.logs.push(e)}printLogs(){!this.logs||this.logs.length==0||(this.renderHandler.addDebugText(this.logs),this.logs=[])}};var w=class{constructor(){this.speed=1;this.canMove=!0}start(){this.gameObject.onCollision.on(e=>{m.getInstance().addLog(`Collision with object: ${e.name}`)})}update(e){this.canMove&&((o.keyDown("KeyA")||o.keyDown("ArrowLeft"))&&(this.gameObject.transform.position.x-=this.speed*e),(o.keyDown("KeyD")||o.keyDown("ArrowRight"))&&(this.gameObject.transform.position.x+=this.speed*e),(o.keyDown("KeyW")||o.keyDown("ArrowUp"))&&(this.gameObject.transform.position.y-=this.speed*e),(o.keyDown("KeyS")||o.keyDown("ArrowDown"))&&(this.gameObject.transform.position.y+=this.speed*e))}};var l=class{constructor(){this.gameObjects=new Array}start(){}static getInstance(){return l.instance||(l.instance=new l),l.instance}addGameObject(e){this.gameObjects.indexOf(e)==-1&&this.gameObjects.push(e)}getGameObjectsWithComponent(e){let t=[];for(let n=this.gameObjects.length;n--;)this.gameObjects[n].hasComponent(u)&&t.push(this.gameObjects[n]);return t}update(e){for(let t=this.gameObjects.length;t--;)this.gameObjects[t].update(e),this.checkCollisions()}checkCollisions(){let e=this.getGameObjectsWithComponent(u);for(let t=e.length;t--;)for(let n=e.length-1;n--;){let c=e[t],p=e[n];this.aabbTest(c,p)&&(c.onCollision.emit(p),p.onCollision.emit(c))}}aabbTest(e,t){return e.transform.position.x<t.transform.position.x+t.transform.width&&e.transform.position.x+e.transform.width>t.transform.position.x&&e.transform.position.y<t.transform.position.y+t.transform.height&&e.transform.position.y+e.transform.height>t.transform.position.y}};var y=class{constructor(){this.listeners=[];this.listenersOncer=[];this.on=e=>(this.listeners.push(e),{dispose:()=>this.off(e)});this.once=e=>{this.listenersOncer.push(e)};this.off=e=>{var t=this.listeners.indexOf(e);t>-1&&this.listeners.splice(t,1)};this.emit=e=>{if(this.listeners.forEach(t=>t(e)),this.listenersOncer.length>0){let t=this.listenersOncer;this.listenersOncer=[],t.forEach(n=>n(e))}};this.pipe=e=>this.on(t=>e.emit(t))}};var g=class{constructor(e){this.components=new Array;this.onCollision=new y;this.logHandler=m.getInstance();l.getInstance().addGameObject(this),this.transform=this.addComponent(new f),this.name=e||"New GameObject",this.start()}start(){this.logHandler.addLog(`Started ${this.name}`)}update(e){for(let t=this.components.length;t--;)this.components[t].update(e)}addComponent(e){let t=e;return t.gameObject=this,this.components.indexOf(t)==-1?(this.components.push(t),t.start(),e):null}getComponent(e){for(let t=this.components.length;t--;){let n=this.components[t];if(n instanceof e)return n}return null}removeComponent(e){let t=-1;for(let n=this.components.length;n--;)this.components[n]==e&&(t=n);t!=-1&&this.components.splice(t,1)}hasComponent(e){for(let t=this.components.length;t--;)if(this.components[t]instanceof e)return!0;return!1}};var r=class{static getInstance(){return r.instance||(r.instance=new r),r.instance}constructor(){window.addEventListener("mousemove",e=>{r.mouseX=e.x,r.mouseY=e.y}),window.addEventListener("mousedown",()=>{r.mouseDown=!0}),window.addEventListener("mouseup",()=>{r.mouseDown=!1})}static getPosition(){return new i(r.mouseX,r.mouseY)}static isOverObject(e,t){let n=r.getPosition();return Math.pow(n.x-e.x,2)+Math.pow(n.y-e.y,2)<Math.pow(t,2)}};var b=class{start(){this.renderer=this.gameObject.getComponent(h),this.renderer&&(this.image=this.renderer.image)}update(e){if(!this.shouldFollow)return;let t=r.getPosition();this.image?this.gameObject.transform.position=new i(t.x-this.image.width/2,t.y-this.image.height/2):this.gameObject.transform.position=t}};var C=class{start(){this.followMouse=this.gameObject.getComponent(b),this.followMouse.shouldFollow=!1}update(e){if(!r.mouseDown){this.followMouse.shouldFollow=!1;return}r.isOverObject(this.gameObject.transform.getCenter(),50)&&(this.followMouse.shouldFollow=!0)}};var j=l.getInstance(),I=a.getInstance(),D=o.getInstance(),R=m.getInstance(),xe=new r,v=.01,O=performance.now(),x=0;function V(){j.start(),I.start(),D.start();let s=new g("Player"),e=s.addComponent(new h),t=new Image;t.src="src/assets/player.png",e.image=t,s.transform.height=64,s.transform.width=64,s.addComponent(new u),s.addComponent(new w),s.addComponent(new b),s.addComponent(new C);let n=new g("Wall"),c=n.addComponent(new h),p=new Image;p.src="src/assets/wall.png",c.image=p,n.transform.height=64,n.transform.width=64,n.transform.position=new i(500,500),n.addComponent(new u),window.requestAnimationFrame(T)}function T(){let s=performance.now(),e=s-O;for(O=s,x+=e;x>=v;)j.update(v),x-=v;I.update(v),R.printLogs(),window.requestAnimationFrame(T)}window.onload=()=>V();})();
//# sourceMappingURL=game.js.map
