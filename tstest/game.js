(()=>{var F=Object.defineProperty;var $=(o,e,t)=>e in o?F(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var i=(o,e,t)=>($(o,typeof e!="symbol"?e+"":e,t),t);var x=class{constructor(){i(this,"renderers",new Array);i(this,"debugText",new Array);i(this,"offscreenCanvas");i(this,"offscreenContext");i(this,"displayCanvas");i(this,"displayContext")}start(){this.displayCanvas=document.querySelector("#canvas"),this.offscreenCanvas=document.createElement("canvas"),this.offscreenCanvas.width=this.displayCanvas.width,this.offscreenCanvas.height=this.displayCanvas.height,this.displayContext=this.displayCanvas.getContext("2d"),this.offscreenContext=this.offscreenCanvas.getContext("2d")}static getInstance(){return x.instance||(x.instance=new x),x.instance}addRenderer(e){this.renderers.indexOf(e)==-1&&this.renderers.push(e)}addDebugText(e){this.debugText=e.slice(-20)}update(e){this.clearScreen(),this.drawRenderers(),this.drawDebug(),this.displayContext.drawImage(this.offscreenCanvas,0,0,this.offscreenCanvas.width,this.offscreenCanvas.height)}clearScreen(){this.offscreenContext.fillRect(0,0,this.displayCanvas.width,this.displayCanvas.height)}drawRenderers(){for(let e=this.renderers.length;e--;){let t=this.renderers[e],r=t.image,a=r.width,p=r.height,w=t.gameObject.transform.position.x,y=t.gameObject.transform.position.y;this.offscreenContext.drawImage(r,w,y,a,p)}}drawDebug(){this.offscreenContext.fillStyle="white",this.offscreenContext.globalAlpha=.5,this.offscreenContext.fillRect(this.displayCanvas.width*.8,this.displayCanvas.height*.03,300,320),this.offscreenContext.font="small-caps bold 12px sans-serif",this.offscreenContext.fillStyle="black",this.offscreenContext.globalAlpha=1;for(let e=this.debugText.length;e--;)this.offscreenContext.fillText(this.debugText[e],this.displayCanvas.width*.81,this.displayCanvas.height*.06+15*e)}},b=x;i(b,"instance");var g=class{constructor(){g.logs=[],window.setInterval(g.printLogs,1e3)}static addLog(...e){!e||e.length===0||g.logs.push(...e)}static printLogs(){!g.logs||g.logs.length==0||g.renderHandler.addDebugText(g.logs)}},h=g;i(h,"renderHandler",b.getInstance()),i(h,"logs",[]);var u=class{constructor(){}static getInstance(){return u.instance||(u.instance=new u),u.instance}start(){document.addEventListener("keydown",e=>{e.defaultPrevented||u.pressedKeys.indexOf(e.code)==-1&&u.pressedKeys.push(e.code)}),document.addEventListener("keyup",e=>{if(e.defaultPrevented)return;let t=u.pressedKeys.indexOf(e.code);t!=-1&&u.pressedKeys.splice(t,1)}),h.addLog("Started InputHandler")}static keyDown(e){return this.pressedKeys.indexOf(e)!=-1}},s=u;i(s,"instance"),i(s,"pressedKeys",new Array);var C=class{constructor(){i(this,"listeners",[]);i(this,"listenersOncer",[]);i(this,"on",e=>(this.listeners.push(e),{dispose:()=>this.off(e)}));i(this,"once",e=>{this.listenersOncer.push(e)});i(this,"off",e=>{var t=this.listeners.indexOf(e);t>-1&&this.listeners.splice(t,1)});i(this,"emit",e=>{if(this.listeners.forEach(t=>t(e)),this.listenersOncer.length>0){let t=this.listenersOncer;this.listenersOncer=[],t.forEach(r=>r(e))}});i(this,"pipe",e=>this.on(t=>e.emit(t)))}};var n=class{constructor(e,t){i(this,"x",0);i(this,"y",0);i(this,"toString",()=>`(x: ${this.x.toPrecision(5)}, y: ${this.y.toPrecision(5)})`);e!==void 0&&(this.x=e),t!==void 0&&(this.y=t)}add(e){return e instanceof n?new n(this.x+e.x,this.y+e.y):new n(this.x+e,this.y+e)}subtract(e){return e instanceof n?new n(this.x-e.x,this.y-e.y):new n(this.x-e,this.y-e)}multiply(e){return e instanceof n?new n(this.x*e.x,this.y*e.y):new n(this.x*e,this.y*e)}static addVectors(e,t){return new n(e.x+t.x,e.y+t.y)}static subtractVectors(e,t){return new n(e.x-t.x,e.y-t.y)}static multiplyVectors(e,t){return new n(e.x*t.x,e.y*t.y)}static distance(e,t){return n.len(n.subtractVectors(e,t))}static normalize(e){let t=n.len(e);return new n(e.x/t,e.y/t)}static len(e){return Math.sqrt(e.x*e.x+e.y*e.y)}};var f=class{constructor(e){i(this,"gameObject");i(this,"image");e!==void 0&&(this.image=e),b.getInstance().addRenderer(this)}start(){}update(e){}};var O=class{constructor(e,t,r,a,p){i(this,"position",new n);i(this,"width");i(this,"height");i(this,"startPosition");i(this,"endPosition");i(this,"isMoving",!1);i(this,"distance");i(this,"direction");i(this,"speed");i(this,"gameObject");e!==void 0&&(this.position.x=e),t!==void 0&&(this.position.y=t),r!==void 0&&(this.width=r),a!==void 0&&(this.height=a),p!==void 0&&(this.position=p)}start(){}update(e){this.isMoving&&(this.position=n.addVectors(this.position,this.direction.multiply(this.speed*e)),n.distance(this.startPosition,this.position)>=this.distance&&(this.position=this.endPosition,this.isMoving=!1))}moveTo(e,t){this.startPosition=this.position,this.endPosition=e,this.distance=n.distance(this.startPosition,e),this.speed=t/1e3,this.direction=n.normalize(n.subtractVectors(e,this.startPosition)),this.isMoving=!0}getCenter(){let e=this.gameObject.getComponent(f);if(!e)return;let t=e.image.width,r=e.image.height;return new n(this.position.x+t/2,this.position.y+r/2)}};var d=class{constructor(){i(this,"collisionEnter",new C);i(this,"collision",new C);i(this,"collisionExit",new C);i(this,"gameObject");i(this,"transform");i(this,"collidedGameObjects",[]);i(this,"toString",()=>`${this.transform.position} - (${this.transform.height}, ${this.transform.width})`)}start(){this.transform=this.gameObject.getComponent(O)}update(e){}};var m=class{constructor(){}start(){}static getInstance(){return m.instance||(m.instance=new m),m.instance}static addGameObject(e){m.gameObjects.indexOf(e)==-1&&m.gameObjects.push(e)}getGameObjectsWithComponent(e){let t=[];for(let r=m.gameObjects.length;r--;)m.gameObjects[r].hasComponent(d)&&t.push(m.gameObjects[r]);return t}update(e){for(let t=m.gameObjects.length;t--;)m.gameObjects[t].update(e),this.checkCollisions()}checkCollisions(){let e=this.getGameObjectsWithComponent(d);for(let t=0;t<e.length;t++)for(let r=t+1;r<e.length;r++){if(e[t]===e[r])continue;let a=e[t],p=e[r],w=a.getComponent(d),y=p.getComponent(d),E=y.collidedGameObjects.findIndex(D=>D===a),R=w.collidedGameObjects.findIndex(D=>D===p),V=this.aabbTest(a,p);V?(w.collision.emit(p),y.collision.emit(a),R===-1&&(w.collidedGameObjects.push(p),w.collisionEnter.emit(p)),E===-1&&(y.collidedGameObjects.push(a),y.collisionEnter.emit(a))):V||(R!==-1&&(w.collidedGameObjects.splice(R,1),w.collisionExit.emit(p)),E!==-1&&(y.collidedGameObjects.splice(E,1),y.collisionExit.emit(a)))}}aabbTest(e,t){return e.transform.position.x<t.transform.position.x+t.transform.width&&e.transform.position.x+e.transform.width>t.transform.position.x&&e.transform.position.y<t.transform.position.y+t.transform.height&&e.transform.position.y+e.transform.height>t.transform.position.y}},v=m;i(v,"instance"),i(v,"gameObjects",new Array);var c=class{static getInstance(){return c.instance||(c.instance=new c),c.instance}constructor(){window.addEventListener("mousemove",e=>{c.mouseX=e.x,c.mouseY=e.y}),window.addEventListener("mousedown",()=>{c.mouseDown=!0}),window.addEventListener("mouseup",()=>{c.mouseDown=!1})}static getPosition(){return new n(c.mouseX,c.mouseY)}static isOverObject(e,t){let r=c.getPosition();return Math.pow(r.x-e.x,2)+Math.pow(r.y-e.y,2)<Math.pow(t,2)}},l=c;i(l,"mouseX"),i(l,"mouseY"),i(l,"mouseDown"),i(l,"instance");var j=class{constructor(e){i(this,"components",new Array);i(this,"transform");i(this,"name");i(this,"toString",()=>`${this.name}`);v.addGameObject(this),this.transform=this.addComponent(new O),this.name=e||"New GameObject",this.start()}start(){h.addLog(`Started ${this.name}`)}update(e){for(let t=this.components.length;t--;)this.components[t].update(e)}addComponent(e){let t=e;return t.gameObject=this,this.components.indexOf(t)==-1?(this.components.push(t),t.start(),e):null}getComponent(e){for(let t=this.components.length;t--;){let r=this.components[t];if(r instanceof e)return r}return null}removeComponent(e){let t=-1;for(let r=this.components.length;r--;)this.components[r]==e&&(t=r);t!=-1&&this.components.splice(t,1)}hasComponent(e){for(let t=this.components.length;t--;)if(this.components[t]instanceof e)return!0;return!1}};var T=class extends j{constructor(){super(...arguments);i(this,"collider");i(this,"renderer")}start(){this.collider=this.addComponent(new d),this.renderer=this.addComponent(new f);let t=new Image;t.src="src/assets/wall.png",this.renderer.image=t,this.transform.height=64,this.transform.width=64,this.transform.position=new n(500,500)}};var I=class{constructor(){i(this,"gameObject");i(this,"shouldFollow");i(this,"renderer");i(this,"image")}start(){this.renderer=this.gameObject.getComponent(f),this.renderer&&(this.image=this.renderer.image)}update(e){if(!this.shouldFollow)return;let t=l.getPosition();this.image?this.gameObject.transform.position=new n(t.x-this.image.width/2,t.y-this.image.height/2):this.gameObject.transform.position=t}};var G=class{constructor(){i(this,"gameObject");i(this,"followMouse")}start(){this.followMouse=this.gameObject.getComponent(I),this.followMouse.shouldFollow=!1}update(e){if(!l.mouseDown){this.followMouse.shouldFollow=!1;return}l.isOverObject(this.gameObject.transform.getCenter(),50)&&(this.followMouse.shouldFollow=!0)}};var L=class{constructor(){i(this,"speed",1);i(this,"gameObject");i(this,"canMove",!0)}start(){}update(e){this.canMove&&((s.keyDown("KeyA")||s.keyDown("ArrowLeft"))&&(this.gameObject.transform.position.x-=this.speed*e),(s.keyDown("KeyD")||s.keyDown("ArrowRight"))&&(this.gameObject.transform.position.x+=this.speed*e),(s.keyDown("KeyW")||s.keyDown("ArrowUp"))&&(this.gameObject.transform.position.y-=this.speed*e),(s.keyDown("KeyS")||s.keyDown("ArrowDown"))&&(this.gameObject.transform.position.y+=this.speed*e))}};var H=class extends j{constructor(){super(...arguments);i(this,"renderer");i(this,"collider");i(this,"playerMovement")}start(){this.renderer=this.addComponent(new f);let t=new Image;t.src="src/assets/player.png",this.renderer.image=t,this.transform.height=64,this.transform.width=64,this.collider=this.addComponent(new d),this.playerMovement=this.addComponent(new L),this.addComponent(new I),this.addComponent(new G)}};var A=v.getInstance(),S=b.getInstance(),W=s.getInstance(),rt=new l,M=.01,k=performance.now(),P=0;function q(){A.start(),S.start(),W.start();let o=new H,e=new T;window.requestAnimationFrame(K)}function K(){let o=performance.now(),e=o-k;for(k=o,P+=e;P>=M;)A.update(M),P-=M;S.update(M),h.printLogs(),window.requestAnimationFrame(K)}window.onload=()=>q();})();
//# sourceMappingURL=game.js.map
