(()=>{var r=class{constructor(e,t){this.x=0;this.y=0;e!==void 0&&(this.x=e),t!==void 0&&(this.y=t)}add(e){return e instanceof r?new r(this.x+e.x,this.y+e.y):new r(this.x+e,this.y+e)}subtract(e){return e instanceof r?new r(this.x-e.x,this.y-e.y):new r(this.x-e,this.y-e)}multiply(e){return e instanceof r?new r(this.x*e.x,this.y*e.y):new r(this.x*e,this.y*e)}static addVectors(e,t){return new r(e.x+t.x,e.y+t.y)}static subtractVectors(e,t){return new r(e.x-t.x,e.y-t.y)}static multiplyVectors(e,t){return new r(e.x*t.x,e.y*t.y)}static distance(e,t){return r.len(r.subtractVectors(e,t))}static normalize(e){let t=r.len(e);return new r(e.x/t,e.y/t)}static len(e){return Math.sqrt(e.x*e.x+e.y*e.y)}};var c=class{constructor(){this.renderers=new Array}start(){this.displayCanvas=document.querySelector("#canvas"),this.offscreenCanvas=document.createElement("canvas"),this.offscreenCanvas.width=this.displayCanvas.width,this.offscreenCanvas.height=this.displayCanvas.height,this.displayContext=this.displayCanvas.getContext("2d"),this.offscreenContext=this.offscreenCanvas.getContext("2d")}static getInstance(){return c.instance||(c.instance=new c),c.instance}addRenderer(e){this.renderers.indexOf(e)==-1&&this.renderers.push(e)}update(e){this.clearScreen();for(let t=this.renderers.length;t--;){let n=this.renderers[t],s=n.image,m=s.width,G=s.height,L=n.gameObject.transform.position.x,H=n.gameObject.transform.position.y;this.offscreenContext.drawImage(s,L,H,m,G)}this.displayContext.drawImage(this.offscreenCanvas,0,0,this.offscreenCanvas.width,this.offscreenCanvas.height)}clearScreen(){this.offscreenContext.fillRect(0,0,this.displayCanvas.width,this.displayCanvas.height)}};var u=class{constructor(e){e!==void 0&&(this.image=e),c.getInstance().addRenderer(this)}start(){}update(e){}};var f=class{constructor(e,t,n,s,m){this.position=new r;this.isMoving=!1;e!==void 0&&(this.position.x=e),t!==void 0&&(this.position.y=t),n!==void 0&&(this.width=n),s!==void 0&&(this.height=s),m!==void 0&&(this.position=m)}start(){}update(e){this.isMoving&&(this.position=r.addVectors(this.position,this.direction.multiply(this.speed*e)),r.distance(this.startPosition,this.position)>=this.distance&&(this.position=this.endPosition,this.isMoving=!1))}moveTo(e,t){this.startPosition=this.position,this.endPosition=e,this.distance=r.distance(this.startPosition,e),this.speed=t/1e3,this.direction=r.normalize(r.subtractVectors(e,this.startPosition)),this.isMoving=!0}getCenter(){let e=this.gameObject.getComponent(u);if(!e)return;let t=e.image.width,n=e.image.height;return new r(this.position.x+t/2,this.position.y+n/2)}};var h=class{start(){this.transform=this.gameObject.getComponent(f)}update(e){}};var p=class{constructor(){}static getInstance(){return p.instance||(p.instance=new p),p.instance}start(){document.addEventListener("keydown",e=>{e.defaultPrevented||p.pressedKeys.indexOf(e.code)==-1&&p.pressedKeys.push(e.code)}),document.addEventListener("keyup",e=>{if(e.defaultPrevented)return;let t=p.pressedKeys.indexOf(e.code);t!=-1&&p.pressedKeys.splice(t,1)})}static keyDown(e){return this.pressedKeys.indexOf(e)!=-1}},a=p;a.pressedKeys=new Array;var l=class{constructor(){this.logs=[];this.logs=[],window.setInterval(this.printLogs,1e3)}static getInstance(){return l.instance||(l.instance=new l),l.instance}addLog(e){this.logs.push(e)}printLogs(){!this.logs||this.logs.length==0||(console.group(this.logs),console.groupEnd(),this.logs=[])}};var y=class{constructor(){this.speed=1;this.canMove=!0}start(){this.gameObject.onCollision.on(e=>{l.getInstance().addLog(`Collision with object: ${e.name}`)})}update(e){!this.canMove||((a.keyDown("KeyA")||a.keyDown("ArrowLeft"))&&(this.gameObject.transform.position.x-=this.speed*e),(a.keyDown("KeyD")||a.keyDown("ArrowRight"))&&(this.gameObject.transform.position.x+=this.speed*e),(a.keyDown("KeyW")||a.keyDown("ArrowUp"))&&(this.gameObject.transform.position.y-=this.speed*e),(a.keyDown("KeyS")||a.keyDown("ArrowDown"))&&(this.gameObject.transform.position.y+=this.speed*e))}};var d=class{constructor(){this.gameObjects=new Array}start(){}static getInstance(){return d.instance||(d.instance=new d),d.instance}addGameObject(e){this.gameObjects.indexOf(e)==-1&&this.gameObjects.push(e)}getGameObjectsWithComponent(e){let t=[];for(let n=this.gameObjects.length;n--;)this.gameObjects[n].hasComponent(h)&&t.push(this.gameObjects[n]);return t}update(e){for(let t=this.gameObjects.length;t--;)this.gameObjects[t].update(e),this.checkCollisions()}checkCollisions(){let e=this.getGameObjectsWithComponent(h);for(let t=e.length;t--;)for(let n=e.length-1;n--;){let s=e[t],m=e[n];this.aabbTest(s,m)&&(s.onCollision.emit(m),m.onCollision.emit(s))}}aabbTest(e,t){return e.transform.position.x<t.transform.position.x+t.transform.width&&e.transform.position.x+e.transform.width>t.transform.position.x&&e.transform.position.y<t.transform.position.y+t.transform.height&&e.transform.position.y+e.transform.height>t.transform.position.y}};var v=class{constructor(){this.listeners=[];this.listenersOncer=[];this.on=e=>(this.listeners.push(e),{dispose:()=>this.off(e)});this.once=e=>{this.listenersOncer.push(e)};this.off=e=>{var t=this.listeners.indexOf(e);t>-1&&this.listeners.splice(t,1)};this.emit=e=>{if(this.listeners.forEach(t=>t(e)),this.listenersOncer.length>0){let t=this.listenersOncer;this.listenersOncer=[],t.forEach(n=>n(e))}};this.pipe=e=>this.on(t=>e.emit(t))}};var g=class{constructor(e){this.components=new Array;this.onCollision=new v;d.getInstance().addGameObject(this),this.transform=this.addComponent(new f),this.name=e||"New GameObject",this.start()}start(){console.log(`Started ${this.name}`)}update(e){for(let t=this.components.length;t--;)this.components[t].update(e)}addComponent(e){let t=e;return t.gameObject=this,this.components.indexOf(t)==-1?(this.components.push(t),t.start(),e):null}getComponent(e){for(let t=this.components.length;t--;){let n=this.components[t];if(n instanceof e)return n}return null}removeComponent(e){let t=-1;for(let n=this.components.length;n--;)this.components[n]==e&&(t=n);t!=-1&&this.components.splice(t,1)}hasComponent(e){for(let t=this.components.length;t--;)if(this.components[t]instanceof e)return!0;return!1}};var o=class{static getInstance(){return o.instance||(o.instance=new o),o.instance}constructor(){window.addEventListener("mousemove",e=>{o.mouseX=e.x,o.mouseY=e.y}),window.addEventListener("mousedown",()=>{o.mouseDown=!0}),window.addEventListener("mouseup",()=>{o.mouseDown=!1})}static getPosition(){return new r(o.mouseX,o.mouseY)}static isOverObject(e,t){let n=o.getPosition();return Math.pow(n.x-e.x,2)+Math.pow(n.y-e.y,2)<Math.pow(t,2)}};var b=class{start(){this.renderer=this.gameObject.getComponent(u),this.renderer&&(this.image=this.renderer.image)}update(e){if(!this.shouldFollow)return;let t=o.getPosition();this.image?this.gameObject.transform.position=new r(t.x-this.image.width/2,t.y-this.image.height/2):this.gameObject.transform.position=t}};var C=class{start(){this.followMouse=this.gameObject.getComponent(b),this.followMouse.shouldFollow=!1}update(e){if(!o.mouseDown){this.followMouse.shouldFollow=!1;return}o.isOverObject(this.gameObject.transform.getCenter(),50)&&(this.followMouse.shouldFollow=!0)}};var j=d.getInstance(),x=c.getInstance(),M=a.getInstance(),D=l.getInstance(),Ce=new o,w=.01,I=performance.now(),O=0;function E(){j.start(),x.start(),M.start();let i=new g("Player"),e=i.addComponent(new u),t=new Image;t.src="src/assets/player.png",e.image=t,i.transform.height=64,i.transform.width=64,i.addComponent(new h),i.addComponent(new y),i.addComponent(new b),i.addComponent(new C);let n=new g("Wall"),s=n.addComponent(new u),m=new Image;m.src="src/assets/wall.png",s.image=m,n.transform.height=64,n.transform.width=64,n.transform.position=new r(500,500),n.addComponent(new h),window.requestAnimationFrame(T)}function T(){let i=performance.now(),e=i-I;for(I=i,O+=e;O>=w;)j.update(w),O-=w;x.update(w),D.printLogs(),window.requestAnimationFrame(T)}window.onload=()=>E();})();
//# sourceMappingURL=game.js.map
